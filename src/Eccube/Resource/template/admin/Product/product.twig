{#
This file is part of EC-CUBE

Copyright(c) EC-CUBE CO.,LTD. All Rights Reserved.

http://www.ec-cube.co.jp/

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.
#}
{% extends '@admin/default_frame.twig' %}

{% set menus = ['product', 'product_edit'] %}

{% block title %}{{ 'admin.product.product_registration'|trans }}{% endblock %}
{% block sub_title %}{{ 'admin.product.product_management'|trans }}{% endblock %}

{% form_theme form '@admin/Form/bootstrap_4_horizontal_layout.html.twig' %}

{% block stylesheet %}
    <link rel="stylesheet" href="{{ asset('assets/css/fileupload/jquery.fileupload.css', 'admin') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/fileupload/jquery.fileupload-ui.css', 'admin') }}">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <style>
        #thumb_product_image_small div,
        #thumb_product_image_large div,
        #thumb_package_image div {
            float: left;
            margin: 4px
        }

        .ui-state-highlight {
            height: 170px;
            width: 170px;
            border: dashed 1px #ccc;
            background: #fff;
        }
    </style>
{% endblock stylesheet %}

{% block javascript %}
    <script src="{{ asset('assets/js/vendor/fileupload/vendor/jquery.ui.widget.js', 'admin') }}"></script>
    <script src="{{ asset('assets/js/vendor/fileupload/jquery.iframe-transport.js', 'admin') }}"></script>
    <script src="{{ asset('assets/js/vendor/fileupload/jquery.fileupload.js', 'admin') }}"></script>
    <script src="{{ asset('assets/js/vendor/fileupload/jquery.fileupload-process.js', 'admin') }}"></script>
    <script src="{{ asset('assets/js/vendor/fileupload/jquery.fileupload-validate.js', 'admin') }}"></script>
    <script src="{{ asset('assets/js/jquery.autoKana.js', 'admin') }}"></script>
    <script>var bootstrapTooltip = $.fn.tooltip.noConflict();</script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script>
        $.fn.tooltip = bootstrapTooltip;
        $(document).on('drop dragover', function(e) {
            e.preventDefault();
        });
        {# upload images #}
        var count_add = {{ form.add_images|length|default(0) }};
        var proto_img = '<div class="c-form__fileUploadThumbnail" style="background-image:url(\'__path__\');">' +
        '<a class="delete-image" onClick="deleteImage(\'__id__\',$(this));"><i class="fa fa-times" aria-hidden="true"></i></a>' +
        '</div>';
        var proto_add = '{{ form_widget(form.add_images.vars.prototype) }}';
        var proto_del = '{{ form_widget(form.delete_images.vars.prototype) }}';
        function fileUpload (fileUploadElementId){
            var type = fileUploadElementId.replace(/admin_product_/g, '');
            var progressElem = $(`#thumb_${type}`).parent().find('.progress');
            $('#' + fileUploadElementId).fileupload(
                {
                url: "{{ url('admin_product_image_add') }}",
                type: "post",
                sequentialUploads: true,
                dataType: 'json',
                dropZone: $('#upload-zone'),
                done: function(e, data) {
                    progressElem.hide();
                    $.each(data.result.files, function(index, file) {
                        var path = '{{ asset('', 'temp_image') }}' + file;
                        var $img = $(proto_img.replace(/__path__/g, path).replace(/__id__/g, type));
                        var $new_img = $(proto_add.replace(/__name__/g, count_add));
                        $new_img.val(JSON.stringify({file: file, type: type}));
                        $child = $img.append($new_img);
                        if($(`#thumb_${type} div`).length > 0){
                            deleteImage(type, $(`#thumb_${type} .delete-image`));
                        }
                        $(`#thumb_${type}`).append($child);
                        count_add++;
                    });
                    hideThumbnail(type);
                    updateSortNo(type);
                },
                fail: function(e, data) {
                    alert("{{ 'admin.common.upload_error'|trans }}");
                },
                always: function(e, data) {
                    progressElem.hide();
                    progressElem.find('.progress-bar').width('0%');
                },
                start: function(e, data) {
                    progressElem.show();
                },
                acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
                maxFileSize: 10000000,
                maxNumberOfFiles: 10,
                progressall: function(e, data) {
                    var progress = parseInt(data.loaded / data.total * 100, 10);
                    progressElem.find('.progress-bar').css(
                        'width',
                        progress + '%'
                    );
                },
                processalways: function(e, data) {
                    if (data.files.error) {
                        alert("{{ 'admin.common.upload_error'|trans }}");
                    }
                }
            });
        }

        var hideThumbnail = function(type) {
            if ($(`#thumb_${type} div`).length > 0) {
                $("#icon_no_image").css("display", "none");
            } else {
                $("#icon_no_image").css("display", "");
            }
        };

        var updateSortNo = function(type) {
            $(`#thumb_${type} div`).each(function(index) {
                $(this).find(".sort_no_images").remove();
                filename = JSON.parse($(this).find("input[type='hidden']").val()).file;
                $sortNo = $('<input type="hidden" class="sort_no_images" name="sort_no_images[]" />');
                $sortNo.val(filename + '//' + parseInt(index + 1));
                $(this).append($sortNo);
            });
        };

        var count_del = 0;
        var deleteImage = function(type,elem) {
            var $new_delete_image = $(proto_del.replace(/__name__/g, count_del));
            var thumbnail = elem.parent('div.c-form__fileUploadThumbnail');
            var src = $(thumbnail).find('input').val();
            $new_delete_image.val(src);
            $(`#thumb_${type}`).append($new_delete_image);
            $(thumbnail).remove();
            hideThumbnail(type);
            updateSortNo(type);
            count_del++;
        }

        $(function() {
            $('#admin_product_BroadCategory').select2();
            $('#admin_product_MiddleCategory').select2();
            $('#admin_product_Category').select2();
            $.fn.autoKana('#admin_product_name ', '#admin_product_product_shortname', {katakana:true});

            $("#thumb_product_image_small, #thumb_product_image_large, #thumb_package_image").sortable({
                cursor: 'move',
                opacity: 0.7,
                placeholder: 'ui-state-highlight',
                update: function(event, ui) {
                    var type = $(this).attr('id').replace('thumb_', '');
                    updateSortNo(type);
                }
            });

            {% for image in form.images %}
            var file = JSON.parse({{ image.vars.value|json_encode|raw }}).file;
            var type = JSON.parse({{ image.vars.value|json_encode|raw }}).type;
            var value = {{image.vars.value|json_encode|raw}};
            var $img = $(proto_img.replace(/__path__/g, `{{ asset('${file}', 'save_image') }}`).replace(/__id__/, type));
            var $widget = $(`{{ form_widget(image, {'value': ''}) }}`);
            $widget.val(value);
            $(`#thumb_${type}`).append($img.append($widget));
            {% endfor %}

            {% for add_image in form.add_images %}
            var value = JSON.parse('{{ add_image.vars.value|raw }}');
            var $img = $(proto_img.replace(/__path__/g, `{{ asset('${value.file}', 'temp_image') }}`).replace(/__id__/,value.type));
            var $widget = $(`{{ form_widget(add_image, {'value': ''}) }}`);
            $widget.val('{{ add_image.vars.value|raw }}');
            $(`#thumb_${value.type}`).append($img.append($widget));
            {% endfor %}

            var imageTypes = ['product_image_small', 'product_image_large', 'package_image'];
            for(var i = 0; i < imageTypes.length; i++){
                hideThumbnail(imageTypes[i]);
                updateSortNo(imageTypes[i]);
            }
            // Delete of images
            var count_add = {{ form.add_images|length|default(0) }};
            {% set fileUploadElementId = '' %}

            var mainTags = $('#allTags');
            var adminProductTag = $('#admin_product_Tag');
            $('input', adminProductTag).each(function() {
                if ($(this).is(':checked')) {
                    $('button[data-tag-id="' + $(this).val() + '"]').removeClass('btn-outline-secondary').addClass('btn-outline-primary');
                }
            });
            mainTags.on('click', 'button.btn', function() {
                var btnTag = $(this);
                var tagId = btnTag.data('tag-id');
                if (btnTag.hasClass('btn-outline-primary')) {
                    btnTag.removeClass('btn-outline-primary').addClass('btn-outline-secondary');
                    $('input[value="' + tagId + '"]', mainTags).prop('checked', false);
                } else {
                    btnTag.removeClass('btn-outline-secondary').addClass('btn-outline-primary');
                    $('input[value="' + tagId + '"]', mainTags).prop('checked', true);
                }
            });

            var confirmFormChange = function(form, target, modal) {
                var returnLink = form.find('input[type="hidden"][name*="return_link"]'),
                    saveBtn = modal.find('a[data-action="save"]'),
                    cancelBtn = modal.find('a[data-action="cancel"]');
                modal.on('hidden.bs.modal', function() {
                    returnLink.val('');
                });
                saveBtn.on('click', function() {
                    returnLink.val($(this).data('return-link'));
                    $(this).addClass('disabled');
                    form.submit();
                });
                target.on('click', function() {
                    modal.find('.modal-body .screen-name').text($(this).attr('title'));
                    modal.modal('show');
                    saveBtn.data('return-link', $(this).attr('href'));
                    cancelBtn.attr('href', $(this).attr('href'));
                    return false;
                });
            };
            confirmFormChange($('#form1'), $('a[data-action="confirm"]'), $('#confirmFormChangeModal'))

            {% if Product is defined %}
                //大分類
                {% if Product.BroadCategory.id is defined %}
                    const broadCategoryId = {{ Product.BroadCategory.id|json_encode|raw }};
                    $('#admin_product_BroadCategory').val(broadCategoryId).trigger('change');
                {% endif %}
                //中分類
                {% if Product.MiddleCategory.id is defined %}
                    const middleCategoryId = {{ Product.MiddleCategory.id|json_encode|raw }};
                    console.log(middleCategoryId);
                    console.log($('#admin_product_MiddleCategory'));
                    $('#admin_product_MiddleCategory').val(middleCategoryId).trigger('change');
                {% endif %}

                //送料計算用区分
                {% if Product.DeliveryCalculation.id is defined %}
                    const deliveryCalculationId = {{ Product.DeliveryCalculation.id|json_encode|raw }};
                    $('#admin_product_DeliveryCalculation').val(deliveryCalculationId).trigger('change');
                {% endif %}

                //詰込管理区分
                {% if Product.PackingManagement.id is defined %}
                    const packingManagementId = {{ Product.PackingManagement.id|json_encode|raw }};
                    $('#admin_product_PackingManagement').val(packingManagementId).trigger('change');
                {% endif %}

                //リパック区分
                {% if Product.Repack.id is defined %}
                    const repackId = {{ Product.Repack.id|json_encode|raw }};
                    $('#admin_product_Repack').val(repackId).trigger('change');
                {% endif %}

                //加工区分
                {% if Product.ProcessedProductCategory.id is defined
                 %}
                    const processedProductCategoryId = {{ Product.ProcessedProductCategory.id|json_encode|raw }};
                    $('#admin_product_ProcessedProductCategory').val(processedProductCategoryId).trigger('change');
                {% endif %}

                //仕入先
                {% if Product.ProductSupplier.id is defined %}
                    const productSupplierId = {{ Product.ProductSupplier.id|json_encode|raw }};
                    $('#admin_product_ProductSupplier').val(productSupplierId).trigger('change');
                {% endif %}

                //解凍区分
                {% if Product.DecompressionMethod.id is defined %}
                    const decompressionMethodId = {{ Product.DecompressionMethod.id|json_encode|raw }};
                    $('#admin_product_DecompressionMethod').val(decompressionMethodId).trigger('change');
                {% endif %}

                //カテゴリ
                {% if Product.Category.id is defined %}
                    const category_id = {{ Product.Category.id|json_encode|raw }};
                    $('#admin_product_Category').val(category_id).trigger('change');
                {% endif %}
            {% endif %}


            //select2 autofocus
            $(document).on('select2:open', (e) => {
                if (!$(e.target).attr('multiple')) {
                    document.querySelector('input.select2-search__field').focus();
                }
            });
        });

        // searchWordの実行
        $('#search-category').on('input', function () {
            searchWord($(this).val(), $('.category-li'));
        });
        $('#search-purchasing-group').on('input', function () {
            searchWord($(this).val(), $('.purchasing-group-li'));
        });
        $('#search-brand').on('input', function () {
            searchWord($(this).val(), $('.brand-li'));
        });
          $('#search-topic').on('input', function () {
            searchWord($(this).val(), $('.topic-li'));
        });
        $('#search-maker').on('input', function () {
            searchWord($(this).val(), $('.maker-li'));
        });
        $('#search-supplier').on('input', function () {
            searchWord($(this).val(), $('.supplier-li'));
        });
        $('#search-gift').on('input', function () {
            searchWord($(this).val(), $('.gift-li'));
        });
        $('#search-bulk-buying').on('input', function () {
            searchWord($(this).val(), $('.bulk-buying-li'));
        });
        $('#search-icon').on('input', function () {
            searchWord($(this).val(), $('.icon-li'));
        });
        // transition to edit page after ID search
        $('#to-product-edit-btn').on('click', function () {
            event.preventDefault();
            let productId = parseInt($('#selected-product').val());
            location.href = "{{ url('admin_product_product_edit', {'id': 1}) }}".replace('1', productId);
        });
    </script>
{% endblock javascript %}

{% block main %}
    <!-- 移動確認モーダル-->
    <div class="modal fade" id="confirmFormChangeModal" tabindex="-1" role="dialog"
         aria-labelledby="confirmFormChangeModal" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{{ 'admin.common.move_to_confirm_title'|trans }}</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p class="screen-name"></p>
                </div>
                <div class="modal-footer">
                    <a class="btn btn-ec-conversion" data-action="save" href="javascript:void(0)">
                        {{ 'admin.common.move_to_confirm_save_and_move'|trans }}
                    </a>
                    <a class="btn btn-ec-sub" data-action="cancel" href="javascript:void(0)">
                        {{ 'admin.common.move_to_confirm_move_only'|trans }}
                    </a>
                </div>
            </div>
        </div>
    </div>
    {# {% if not Product.id %} #}
    {% if Product is not defined%}
    {# 商品検索 #}
    <form method='POST' action='{{url('admin_product_product_new')}}'>
        {{ form_widget(searchForm._token) }}
        <div class="c-outsideBlock__contents">
            <div class="row justify-content-start">
                <div class="col-6">
                    <div class="mb-2">
                        <label class="col-form-label" data-tooltip="true" data-placement="top" title="{{ 'tooltip.product.multi_search_label'|trans }}">{{ 'admin.product.product_id'|trans }}</label>
                        {{ form_widget(searchForm.code) }}
                        {{ form_errors(searchForm.code) }}
                        {% if results is not empty %}
                            {% if results is iterable %}
                            <select class='form-control' id='selected-product'>
                                {% for result in results %}
                                    <option value='{{result.id}}'>{{ result.code }}：{{ result.name }}</option>
                                {% endfor %}
                            </select>
                            {% else %}
                                <p class="text-muted mt-2 mb-2">{{results|trans}}</p>
                            {% endif %}
                        {% endif %}
                    </div>
                    {% if searchForm.vars.errors|length > 0 %}
                        <div class="alert alert-danger">
                            <ul>
                            {% for error in searchForm.vars.errors %}
                                <li>{{ error.message }}</li>
                            {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="c-outsideBlock__contents mb-3">
            <button id="search-id-btn" class="btn btn-ec-conversion px-5">{{ 'admin.common.search'|trans }}</button>
            {% if results is not empty%}
                {% if results is iterable %}
                <button id="to-product-edit-btn" class="btn btn-ec-conversion px-5">編集する</button>
                {% endif %}
            {% endif %}
        </div>
    </form>
    {% endif %}
    <form role="form" name="form1" id="form1" method="post" action="" novalidate enctype="multipart/form-data">
        {{ form_widget(form._token) }}
        {{ form_widget(form.return_link) }}
        {% if form.vars.errors|length > 0 %}
            <div class="alert alert-danger">
                <ul>
                {% for error in form.vars.errors %}
                    <li>{{ error.message }}</li>
                {% endfor %}
                </ul>
            </div>
        {% endif %}
        <div class="c-contentsArea__cols">
            <div class="c-contentsArea__primaryCol">
                <div class="c-primaryCol">
                    <div class="card rounded border-0 mb-4">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-8">
                                    <div class="d-inline-block">
                                    <span class="card-title">
                                        {{ 'admin.product.product__card_title'|trans }}
                                    </span>
                                    </div>
                                </div>
                                <div class="col-4 text-right">
                                    <a data-toggle="collapse" href="#basicConfig" aria-expanded="false"
                                       aria-controls="basicConfig">
                                        <i class="fa fa-angle-up fa-lg"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="collapse show ec-cardCollapse" id="basicConfig">
                            <div class="card-body">
                                {# {% if Product  is defined %}
                                    <div class="row">
                                        <div class="col-3">
                                            <div class="d-inline-block" data-tooltip="true" data-placement="top" title="{{ 'tooltip.product.product_id'|trans }}">
                                                <span>{{ 'admin.product.product_id'|trans }}</span>
                                                <i class="fa fa-question-circle fa-lg ml-1"></i>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <p>{{ Product.code }}</p>
                                        </div>
                                    </div>
                                {% endif %} #}
                                {# 商品コード #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>商品コード</span>
                                            <span class="badge badge-primary ml-1">
                                                {{ 'admin.common.required'|trans }}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        {{ form_widget(form.code) }}
                                        {{ form_errors(form.code) }}
                                    </div>
                                </div>
                                {# 商品名 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.name'|trans }}</span>
                                            <span class="badge badge-primary ml-1">
                                                {{ 'admin.common.required'|trans }}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        {{ form_widget(form.name) }}
                                        {{ form_errors(form.name) }}
                                    </div>
                                </div>
                                {# 索引 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.product_index'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.product_index) }}
                                            {{ form_errors(form.product_index) }}
                                        </div>
                                    </div>
                                </div>
                                {# 単位 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.unit'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.unit) }}
                                            {{ form_errors(form.unit) }}
                                        </div>
                                    </div>
                                </div>
                                {# 大分類 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.broad_category_id'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.BroadCategory) }}
                                            {{ form_errors(form.BroadCategory) }}
                                        </div>
                                    </div>
                                </div>
                                {# 中分類 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.middle_category_id'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.MiddleCategory) }}
                                            {{ form_errors(form.MiddleCategory) }}
                                        </div>
                                    </div>
                                </div>
                                {# サイトカテゴリ #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.category'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.Category) }}
                                            {{ form_errors(form.Category) }}
                                        </div>
                                    </div>
                                </div>
                                {# 商品名略称 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.product_shortname'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.product_shortname) }}
                                            {{ form_errors(form.product_shortname) }}
                                        </div>
                                    </div>
                                </div>
                                {# 送料計算用区分 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.delivery_calculation'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.DeliveryCalculation) }}
                                            {{ form_errors(form.DeliveryCalculation) }}
                                        </div>
                                    </div>
                                </div>
                                {# 詰込管理区分 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.packing_management'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.PackingManagement) }}
                                            {{ form_errors(form.PackingManagement) }}
                                        </div>
                                    </div>
                                </div>
                                {# リパック区分 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.repack'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.Repack) }}
                                            {{ form_errors(form.Repack) }}
                                        </div>
                                    </div>
                                </div>
                                {# 加工区分 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.processed_product_category_id'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.ProcessedProductCategory) }}
                                            {{ form_errors(form.ProcessedProductCategory) }}
                                        </div>
                                    </div>
                                </div>
                                {# 仕入先 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.supplier_id'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.ProductSupplier) }}
                                            {{ form_errors(form.ProductSupplier) }}
                                        </div>
                                    </div>
                                </div>
                                {# 量目 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.weight'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.weight) }}
                                            {{ form_errors(form.weight) }}
                                        </div>
                                    </div>
                                </div>
                                {# 加工場所 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.processing_place'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.processing_place) }}
                                            {{ form_errors(form.processing_place) }}
                                        </div>
                                    </div>
                                </div>
                                {# 調理方法 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.cooking_method'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.cooking_method) }}
                                            {{ form_errors(form.cooking_method) }}
                                        </div>
                                    </div>
                                </div>
                                {# 解凍区分 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.decompression_method_id'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.DecompressionMethod) }}
                                            {{ form_errors(form.DecompressionMethod) }}
                                        </div>
                                    </div>
                                </div>
                                {# 塩分 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.salt_amount'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.salt_amount) }}
                                            {{ form_errors(form.salt_amount) }}
                                        </div>
                                    </div>
                                </div>
                                {# カロリー #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.calorie'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.calorie) }}
                                            {{ form_errors(form.calorie) }}
                                        </div>
                                    </div>
                                </div>
                                {# アレルギー #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.allergy'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.allergy) }}
                                            {{ form_errors(form.allergy) }}
                                        </div>
                                    </div>
                                </div>
                                {# 原材料 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.raw_materials'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div>
                                            {{ form_widget(form.raw_materials) }}
                                            {{ form_errors(form.raw_materials) }}
                                        </div>
                                    </div>
                                </div>
                                {# 商品説明１ #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block" data-tooltip="true" data-placement="top"
                                             title="{{ 'tooltip.product.description_detail'|trans }}">
                                            <span>{{ 'admin.product.description_detail'|trans }}</span>
                                            <i class="fa fa-question-circle fa-lg ml-1"></i>
                                        </div>
                                    </div>
                                    <div class="col">
                                        {{ form_widget(form.description_detail, { attr : { rows : "8"} }) }}
                                        {{ form_errors(form.description_detail) }}
                                        <div class="d-inline-block mb-2" data-toggle="collapse" href="#addComment"
                                             role="button" aria-expanded="false" aria-controls="addComment">
                                            <a>
                                                <i class="fa fa-plus-square-o font-weight-bold mr-1"></i>
                                                <span class="font-weight-bold text-ec-black">
                                                    {{ 'admin.product.description_list__add'|trans }}
                                                </span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                {# 商品説明（一覧） #}
                                <div class="collapse ec-collapse" id="addComment">
                                    <div class="row bg-ec-formGray pt-3 mb-2">
                                        <div class="col-3">
                                            <div class="d-inline-block" data-tooltip="true" data-placement="top"
                                                 title="{{ 'tooltip.product.description_list'|trans }}">
                                                <span>{{ 'admin.product.description_list'|trans }}</span>
                                                <i class="fa fa-question-circle fa-lg ml-1"></i>
                                            </div>
                                        </div>
                                        <div class="col mb-4">
                                            <div>
                                                {{ form_widget(form.description_list, { attr : { rows : "4"} }) }}
                                                {{ form_errors(form.description_list) }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {# 商品パッケージ画像 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block" data-tooltip="true" data-placement="top" title="{{ 'tooltip.product.image'|trans }}">
                                            <span>{{ 'admin.product.package_image'|trans }}</span>
                                            <i class="fa fa-question-circle fa-lg ml-1"></i>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div class="progress" style="display: none;">
                                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <div id="thumb_package_image" class="c-form__fileUploadThumbnails clearfix"></div>
                                        <div id="upload-zone" class="media py-5 border-ec-dashed mb-2 rounded">
                                            <div class="media-body">
                                                <i class="fa fa-cloud-upload fa-3x text-ec-lightGray mx-3 align-middle" aria-hidden="true"></i>
                                                {{ 'admin.common.drag_and_drop_image_description'|trans }}
                                                {{ form_widget(form.package_image, { attr : { accept : 'image/*', style : 'display:none;' } }) }}
                                                {{ form_errors(form.package_image) }}
                                                <a class="btn btn-ec-regular mr-2" onclick="$('#admin_product_package_image').click();
                                                    {% set fileUploadElementId = form.package_image.vars.id %}
                                                    fileUpload('{{ fileUploadElementId }}');
                                                ">
                                                    {{ 'admin.common.file_select'|trans }}
                                                </a>
                                            </div><!-- /.media-body -->
                                        </div><!-- /.media -->
                                    </div>
                                </div>
                                {# 商品画像大 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block" data-tooltip="true" data-placement="top" title="{{ 'tooltip.product.image'|trans }}">
                                            <span>{{ 'admin.product.image_large'|trans }}</span>
                                            <i class="fa fa-question-circle fa-lg ml-1"></i>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        <div class="progress" style="display: none;">
                                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <div id="thumb_product_image_large" class="c-form__fileUploadThumbnails clearfix"></div>
                                        <div id="upload-zone" class="media py-5 border-ec-dashed mb-2 rounded">
                                            <div class="media-body">
                                                <i class="fa fa-cloud-upload fa-3x text-ec-lightGray mx-3 align-middle" aria-hidden="true"></i>
                                                {{ 'admin.common.drag_and_drop_image_description'|trans }}
                                                {{ form_widget(form.product_image_large, { attr : { accept : 'image/*', style : 'display:none;' } }) }}
                                                {{ form_errors(form.product_image_large) }}
                                                <a class="btn btn-ec-regular mr-2" onclick="$('#admin_product_product_image_large').click();
                                                    {% set fileUploadElementId = form.product_image_large.vars.id %}
                                                    fileUpload('{{ fileUploadElementId }}');
                                                ">
                                                    {{ 'admin.common.file_select'|trans }}
                                                </a>
                                            </div><!-- /.media-body -->
                                        </div><!-- /.media -->
                                    </div>
                                </div>
                                {# 販売種別 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block" data-tooltip="true" data-placement="top" title="{{ 'tooltip.product.sale_type'|trans }}">
                                            <span>{{ 'admin.product.sale_type'|trans }}</span>
                                            <i class="fa fa-question-circle fa-lg ml-1"></i>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        {{ form_widget(form.sale_type) }}
                                    </div>
                                </div>
                                {# 備考 #}
                                <div class="row">
                                    <div class="col-3">
                                        <div class="d-inline-block">
                                            <span>{{ 'admin.product.note'|trans }}</span>
                                        </div>
                                    </div>
                                    <div class="col mb-2">
                                        {{ form_widget(form.note) }}
                                        {{ form_errors(form.note) }}
                                    </div>
                                </div>
                                {# エンティティ拡張の自動出力 #}
                                {% for f in form|filter(f => f.vars.eccube_form_options.auto_render) %}
                                    {% if f.vars.eccube_form_options.form_theme %}
                                        {% form_theme f f.vars.eccube_form_options.form_theme %}
                                        {{ form_row(f) }}
                                    {% else %}
                                        <div class="row">
                                            <div class="col-3">
                                                <span>{{ f.vars.label|trans }}</span>
                                            </div>
                                            <div class="col mb-2">
                                                <div>
                                                    {{ form_widget(f) }}
                                                    {{ form_errors(f) }}
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% if Product is defined %}
                    <div class="card rounded border-0 mb-4">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-8">
                                    <div class="d-inline-block">
                                    <span class="card-title">
                                        {{ 'admin.product.product__card_title'|trans }}
                                    </span>
                                    </div>
                                </div>
                                <div class="col-4 text-right">
                                    <a data-toggle="collapse" href="#basicConfig" aria-expanded="false"
                                       aria-controls="basicConfig">
                                        <i class="fa fa-angle-up fa-lg"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="collapse show ec-cardCollapse" id="basicConfig">
                            <div class="card-body">
                                <div class="row mb-2">
                                    <div class="col">
                                        <i class="fa fa-flag mr-1"></i>
                                        <span>登録日</span>
                                    </div>
                                    <div class="col">
                                        <span>：{{ Product.create_date|date_min }}</span>
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col">
                                        <i class="fa fa-refresh mr-1"></i>
                                        <span>{{ 'admin.common.update_date'|trans }}</span>
                                    </div>
                                    <div class="col">
                                        <span>：{{ Product.update_date|date_min }}</span>
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col">
                                        <i class="fa fa-user mr-1"></i>
                                        <span>{{ 'admin.common.last_updater'|trans }}</span>
                                    </div>
                                    <div class="col">
                                        <span>：{{ Product.Creator ? Product.Creator.name }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            {# <div class="c-contentsArea__secondaryCol">
                <div class="c-secondaryCol">
                    <div class="card rounded border-0 mb-4">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-8">
                                    <span class="card-title">{{ 'admin.product.create_date__card_title'|trans }}</span>
                                </div>
                                <div class="col-4 text-right">
                                    <a data-toggle="collapse" href="#update" aria-expanded="false"
                                       aria-controls="update">
                                        <i class="fa fa-angle-up fa-lg"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="collapse show ec-cardCollapse" id="update">
                            <div class="card-body">
                                <div class="row mb-2">
                                    <div class="col">
                                        <i class="fa fa-flag mr-1"></i>
                                        <span>{{ 'admin.common.create_date'|trans }}</span>
                                    </div>
                                    <div class="col">
                                        <span>：{{ Product.create_date|date_min }}</span>
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col">
                                        <i class="fa fa-refresh mr-1"></i>
                                        <span>{{ 'admin.common.update_date'|trans }}</span>
                                    </div>
                                    <div class="col">
                                        <span>：{{ Product.update_date|date_min }}</span>
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col">
                                        <i class="fa fa-user mr-1"></i>
                                        <span>{{ 'admin.common.last_updater'|trans }}</span>
                                    </div>
                                    <div class="col">
                                        <span>：{{ Product.Creator ? Product.Creator.name }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> #}
        </div>
        <div class="c-conversionArea">
            <div class="c-conversionArea__container">
                <div class="row justify-content-between align-items-center">
                    <div class="col-6">
                        <div class="c-conversionArea__leftBlockItem">
                            <a class="c-baseLink" href="{{ path('admin_product_page', { page_no : app.session.get('eccube.admin.product.search.page_no')|default('1') } ) }}"
                               data-action="confirm" title="{{ 'admin.common.move_to_confirm_message'|trans({'%name%' : 'admin.product.product_list'|trans }) }}">
                                <i class="fa fa-backward" aria-hidden="true"></i><span>{{ 'admin.product.product_list'|trans }}</span>
                            </a>
                        </div>
                    </div>
                    <div class="col-6">
                        <div id="ex-conversion-action" class="row align-items-center justify-content-end">
                            <div class="col-auto" style="display:none;">
                                {{ form_widget(form.Status) }}
                                {{ form_errors(form.Status) }}
                            </div>
                            {% if Product is defined %}
                            <div class="col-auto">
                                <a class="btn px-5 btn-danger" type="submit" data-toggle="modal" data-target="#discontinuance-{{ Product.id }}">{{ 'admin.common.delete'|trans }}</a>
                            </div>
                            {% endif %}
                            <div class="col-auto">
                                <button class="btn btn-ec-conversion px-5" type="submit">{{ 'admin.common.registration'|trans }}</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% if Product is defined %}
        <div class="modal fade" id="discontinuance-{{ Product.id }}" tabindex="-1" role="dialog" aria-labelledby="discontinuance" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title font-weight-bold">
                            {{ 'admin.common.delete_modal__title'|trans }}</h5>
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body text-left">
                        <p class="text-left">
                            {{ 'admin.common.delete_modal__message'|trans({ '%name%' : Product.name }) }}</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-ec-sub" type="button" data-dismiss="modal">
                            {{ 'admin.common.cancel'|trans }}
                        </button>
                        <a href="{{ url('admin_product_product_delete', {'id' : Product.id}) }}" class="btn btn-ec-delete"{{ csrf_token_for_anchor() }} data-method="delete" data-confirm="false">
                            {{ 'admin.common.delete'|trans }}
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </form>
{% endblock %}
